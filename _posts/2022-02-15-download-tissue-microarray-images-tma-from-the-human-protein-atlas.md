---
layout: post
title: Download tissue microarray images (TMA) from the human protein atlas
author: Felix
comments: false
tags: ''
excerpt_separator: ''
sticky: false
hidden: false

---
The aim is to download microarray tissue images of immunohistochemical staining for HER2 (ERBB2, ENSG00000141736) from the human protein atlas. Images should be from patients with gastric and esophageal cancer.

Enter ERBB2 in the search box on the website [https://www.proteinatlas.org/](https://www.proteinatlas.org/ "https://www.proteinatlas.org/") and then click on "PATHOLOGY". Since we are only interested in images of gastric carcinoma, click on "Stomach" in the PROTEIN EXPRESSION SUMMARY view. 90 TMA images will be displayed. When viewing a specific staining intensity, such as "Low", 2 images of a patient are often displayed. It is also possible to display 4 images of a patient, e.g. for the patient with ID #664 there are 2 images with staining intensity "Low" and 2 with staining intensity "Medium".

![](/assets/tma-image-freom-the-human-protein-atlas.JPG)

We use the highly recommended R-package [HPAnalyze ](https://github.com/anhtr/HPAanalyze "HPAnalyze")by Anh N Tran to download the images. We follow the instructions from [here](https://bioc.ism.ac.jp/packages/3.10/bioc/vignettes/HPAanalyze/inst/doc/f_HPAanalyze_case_images.html "Download histology images from the Human Protein Atlas") and the original [paper](https://bmcbioinformatics.biomedcentral.com/articles/10.1186/s12859-019-3059-z).

First, we download all cases with HER2 analysis and discover that 6 different antibodies were used.

    ERBB2xml <- hpaXmlGet("ENSG00000141736") 	
    
    ERBB2_ab <- hpaXmlAntibody(ERBB2xml)
    ERBB2_ab

<table cellspacing="0" class="table table-condensed"><thead><tr><th align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">id</div><div class="pagedtable-header-type"><chr></div></th><th align="left" style="text-align: left; max-width: 154px; min-width: 154px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">releaseVersion</div><div class="pagedtable-header-type"><chr></div></th><th align="left" style="text-align: left; max-width: 121px; min-width: 121px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">releaseDate</div><div class="pagedtable-header-type"><chr></div></th><th align="left" style="text-align: left; max-width: 110px; min-width: 110px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">RRID</div><div class="pagedtable-header-type"><chr></div></th><th class="pagedtable-padding-col" style="border-bottom-color: rgba(0, 0, 0, 0.12);"></th></tr></thead><tbody><tr class="odd"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">CAB000043</td><td align="left" style="text-align: left; max-width: 154px; min-width: 154px; border-bottom-color: rgba(0, 0, 0, 0.12);">1.2</td><td align="left" style="text-align: left; max-width: 121px; min-width: 121px; border-bottom-color: rgba(0, 0, 0, 0.12);">2006-03-13</td><td align="left" style="text-align: left; max-width: 110px; min-width: 110px; border-bottom-color: rgba(0, 0, 0, 0.12);">AB_2335701</td><td class="pagedtable-padding-col" style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr><tr class="even" style="background-color: rgba(0, 0, 0, 0.02);"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">HPA001060</td><td align="left" style="text-align: left; max-width: 154px; min-width: 154px; border-bottom-color: rgba(0, 0, 0, 0.12);">16.0</td><td align="left" style="text-align: left; max-width: 121px; min-width: 121px; border-bottom-color: rgba(0, 0, 0, 0.12);">2016-12-04</td><td align="left" style="text-align: left; max-width: 110px; min-width: 110px; border-bottom-color: rgba(0, 0, 0, 0.12);">AB_2666185</td><td class="pagedtable-padding-col" style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr><tr class="odd"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">HPA001338</td><td align="left" style="text-align: left; max-width: 154px; min-width: 154px; border-bottom-color: rgba(0, 0, 0, 0.12);">12.0</td><td align="left" style="text-align: left; max-width: 121px; min-width: 121px; border-bottom-color: rgba(0, 0, 0, 0.12);">2013-12-05</td><td align="left" style="text-align: left; max-width: 110px; min-width: 110px; border-bottom-color: rgba(0, 0, 0, 0.12);">AB_2666279</td><td class="pagedtable-padding-col" style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr><tr class="even" style="background-color: rgba(0, 0, 0, 0.02);"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">HPA001383</td><td align="left" style="text-align: left; max-width: 154px; min-width: 154px; border-bottom-color: rgba(0, 0, 0, 0.12);">1.2</td><td align="left" style="text-align: left; max-width: 121px; min-width: 121px; border-bottom-color: rgba(0, 0, 0, 0.12);">2006-03-13</td><td align="left" style="text-align: left; max-width: 110px; min-width: 110px; border-bottom-color: rgba(0, 0, 0, 0.12);">AB_1078500</td><td class="pagedtable-padding-col" style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr><tr class="odd"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">CAB020416</td><td align="left" style="text-align: left; max-width: 154px; min-width: 154px; border-bottom-color: rgba(0, 0, 0, 0.12);">5.0</td><td align="left" style="text-align: left; max-width: 121px; min-width: 121px; border-bottom-color: rgba(0, 0, 0, 0.12);">2009-06-16</td><td align="left" style="text-align: left; max-width: 110px; min-width: 110px; border-bottom-color: rgba(0, 0, 0, 0.12);">AB_442047</td><td class="pagedtable-padding-col" style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr><tr class="even" style="background-color: rgba(0, 0, 0, 0.02);"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">CAB062555</td><td align="left" style="text-align: left; max-width: 154px; min-width: 154px; border-bottom-color: rgba(0, 0, 0, 0.12);">12.0</td><td align="left" style="text-align: left; max-width: 121px; min-width: 121px; border-bottom-color: rgba(0, 0, 0, 0.12);">2013-12-05</td><td align="left" style="text-align: left; max-width: 110px; min-width: 110px; border-bottom-color: rgba(0, 0, 0, 0.12);">AB_2665610</td><td class="pagedtable-padding-col" style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr></tbody></table>

Then we merge all cases

    ERBB2_all <- bind_rows(ERBB2_expr)

Now, we select all gastric cancer and esophageal cancer cases

    ERBB2_stomach <-  ERBB2_all %>% filter(tissueDescription1 == "Adenocarcinoma, NOS" &  (str_detect(tissueDescription2, "^Stomach") | tissueDescription2 == "Esophagus"))

Then we download the images

    dir.create("img")
    
    
    for (i in 1:nrow(ERBB2_stomach)) {
        download.file(ERBB2_stomach$imageUrl[i],
                      destfile = paste0("img/", ERBB2_ab$id[1], "_",
                                        ERBB2_stomach$patientId[i], "_", 
                                        ERBB2_stomach$tissueDescription1[i], "_", 
                                        ERBB2_stomach$staining[i],
                                        ".jpg"),
                      mode = "wb")
    }

<table cellspacing="0" class="table table-condensed"><thead><tr><th align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">patientId</div><div class="pagedtable-header-type">&lt;chr&gt;</div></th><th align="left" style="text-align: left; max-width: 33px; min-width: 33px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">age</div><div class="pagedtable-header-type">&lt;chr&gt;</div></th><th align="left" style="text-align: left; max-width: 66px; min-width: 66px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">sex</div><div class="pagedtable-header-type">&lt;chr&gt;</div></th><th align="left" style="text-align: left; max-width: 88px; min-width: 88px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">staining</div><div class="pagedtable-header-type">&lt;chr&gt;</div></th><th align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">intensity</div><div class="pagedtable-header-type">&lt;chr&gt;</div></th><th align="left" style="text-align: left; max-width: 88px; min-width: 88px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">quantity</div><div class="pagedtable-header-type">&lt;chr&gt;</div></th><th align="left" style="text-align: left; max-width: 242px; min-width: 242px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div class="pagedtable-header-name">location</div><div class="pagedtable-header-type">&lt;chr&gt;</div></th><th style="cursor: pointer; vertical-align: middle; min-width: 5px; width: 5px; border-bottom-color: rgba(0, 0, 0, 0.12);"><div style="border-top: 5px solid transparent;border-bottom: 5px solid transparent;border-left: 5px solid;"></div></th></tr></thead><tbody><tr class="odd"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">664</td><td align="left" style="text-align: left; max-width: 33px; min-width: 33px; border-bottom-color: rgba(0, 0, 0, 0.12);">50</td><td align="left" style="text-align: left; max-width: 66px; min-width: 66px; border-bottom-color: rgba(0, 0, 0, 0.12);">Female</td><td align="left" style="text-align: left; max-width: 88px; min-width: 88px; border-bottom-color: rgba(0, 0, 0, 0.12);">Low</td><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">Moderate</td><td align="left" style="text-align: left; max-width: 88px; min-width: 88px; border-bottom-color: rgba(0, 0, 0, 0.12);">&lt;25%</td><td align="left" style="text-align: left; max-width: 242px; min-width: 242px; border-bottom-color: rgba(0, 0, 0, 0.12);">cytoplasmic/membranous</td><td style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr><tr class="even" style="background-color: rgba(0, 0, 0, 0.02);"><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">664</td><td align="left" style="text-align: left; max-width: 33px; min-width: 33px; border-bottom-color: rgba(0, 0, 0, 0.12);">50</td><td align="left" style="text-align: left; max-width: 66px; min-width: 66px; border-bottom-color: rgba(0, 0, 0, 0.12);">Female</td><td align="left" style="text-align: left; max-width: 88px; min-width: 88px; border-bottom-color: rgba(0, 0, 0, 0.12);">Medium</td><td align="left" style="text-align: left; max-width: 99px; min-width: 99px; border-bottom-color: rgba(0, 0, 0, 0.12);">Moderate</td><td align="left" style="text-align: left; max-width: 88px; min-width: 88px; border-bottom-color: rgba(0, 0, 0, 0.12);">&gt;75%</td><td align="left" style="text-align: left; max-width: 242px; min-width: 242px; border-bottom-color: rgba(0, 0, 0, 0.12);">cytoplasmic/membranous</td><td style="border-bottom-color: rgba(0, 0, 0, 0.12);"></td></tr></tbody></table>